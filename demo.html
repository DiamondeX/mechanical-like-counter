<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script type="text/javascript" src="jquery-1.11.2.min.js"></script>
  <script type="text/javascript" src="mechounter.js"></script>
  <link rel="stylesheet" href="mechounter.css">
</head>
<body>
  <button id="btn0">go!</button>
  <button id="btn1">go!</button>
  <button id="btn2">go!</button>
  <button id="btn3">go!</button>
  <button id="btn4">s</button>
  <button id="btn5">f</button>
  <br>
  <span id="someValue">234.00</span>
  <br>
  <span id="debug"></span>
  <br>
  <span id="debug2"></span>


  <script>
    $(function(){

      var dt, dv, v0, lx;
      $g = $("#graph");

      window.initDraw = function(dt_, dv_, v0_){
        lx = -10;
        dt = dt_;
        dv = dv_;
        v0 = v0_;
        $g.html("");
        $("#debug2").text("dt:"+dt + ", dv:" +dv+", v0:"+v0);
      };

      window.draw = function(t, v){
        var x = t/dt * 400;
        if(x == lx) return;
        lx = x;

        var y = 400 - (v-v0)/dv * 400;
        $g.append("<div style='position: absolute; top: " + y + "px; left: " + x + "px; width: 1px; height: 1px; background: red'/>");
        y = 400 - Math.log(1+(v-v0)/dv * 1.718281828459045) * 400;
        $g.append("<div style='position: absolute; top: " + y + "px; left: " + x + "px; width: 1px; height: 1px; background: blue'/>");
        y = 400 - Math.log(1+Math.log(1+(v-v0)/dv * 1.718281828459045) * 1.718281828459045) * 400;
        $g.append("<div style='position: absolute; top: " + y + "px; left: " + x + "px; width: 1px; height: 1px; background: green'/>");
        $("#debug").text("t:"+t + ", v:" +v+", x:"+x+", y: "+y);
      };

      window.ani = function (delayMs){
        var start = Date.now();
        var dgt = window.cntr._digits[0];
        var v = dgt.$card0.text() % 10;
        var interv = setInterval(function(){
          var elapsed = Date.now() - start;
          if(elapsed > delayMs){
            dgt.setValue(v + 1);
            clearInterval(interv);
            return;
          }
          var part = elapsed / delayMs;
          dgt.setValue(v+part);
        }, 5);
      }

      var cntr = window.cntr = new MechanicalCounter($("#someValue"), {
        mask: "`1,0",
        value: 345
      });

      $("#btn0").click(function(){
        cntr.fillValue(5022.98);
      });

      $("#btn1").click(function(){
        cntr.setValue(15022.999, 20000);
      });

      $("#btn2").click(function(){
        cntr.fillValue(235);
      });

      $("#btn3").click(function(){
        cntr.spinValue(345);
      });

      $("#btn4").keydown(function(e){
        var d = 0;
        switch(e.keyCode) {
          case 37: d = -0.01; break;
          case 38: d = -0.10; break;
          case 39: d = +0.01; break;
          case 40: d = +0.10; break;
          default:
            break;
        }
        cntr.spinValue(cntr._value + d);
      });

      $("#btn5").keydown(function(e){
        var d = 0;
        switch(e.keyCode) {
          case 37: d = -0.01; break;
          case 38: d = -0.10; break;
          case 39: d = +0.01; break;
          case 40: d = +0.10; break;
          default:
            break;
        }
        cntr.fillValue(cntr._value + d);
      });

    });
  </script>
  <div id='graph' style='position:absolute; width: 400px; height: 400px; background: #fde; top: 0; left: 200px; z-index: -1'></div>
  </body>
</html>
