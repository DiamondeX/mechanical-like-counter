<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script type="text/javascript" src="jquery-1.11.2.min.js"></script>
  <script type="text/javascript" src="mechounter.js"></script>
  <link rel="stylesheet" href="mechounter.css">
</head>
<body>
  <style>
    #list {
      position: absolute;
      width: 300px;
      top: 0;
      left: 650px;
      background: #efd;
      border: solid 1px #dfb;
      border-radius: 5px;
      padding: 0 6px;
    }
    #list > div {
      border: solid 1px #dfb;
      border-radius: 3px;
      margin: 4px 0;
      padding: 2px 6px;
      cursor: pointer;
    }
    button{
      cursor: pointer;
    }
  </style>
  <button id="btn_">?</button>
  <button id="btn0">1s</button>
  <button id="btnM">1m</button>
  <button id="btn1">1f</button>
  <button id="btn2">7s</button>
  <button id="btn3">7f</button>
  <button id="btn4">8m</button>
  <button id="btn5">9m</button>
  <button id="btnS">s</button>
  <button id="btnF">f</button>
  <br>
  <span id="someValue">234.00</span>
  <br>
  <span id="debug"></span>
  <br>
  <span id="debug2"></span>

  <br><input id="difVal" type="number" min="0" max="100000000" value="175905" placeholder="Новое значение" title="Новое значение" style="width: 170px"/>
  <br><input id="time" type="number" min="0" max="20000" value="5000" placeholder="Интервал в меллисекундах" title="Интервал в меллисекундах" style="width: 170px"/>
  <br><button id="btnGo">go!</button>


  <script>
    $(function(){

      var dt, dv, v0, lx;
      $g = $("#graph");

      window.initDraw = function(dt_, dv_, v0_){
        lx = -10;
        dt = dt_;
        dv = dv_;
        v0 = v0_;
        $g.html("");
        $("#debug2").text("dt:"+dt + ", dv:" +dv+", v0:"+v0);
      };

      window.draw = function(t, v){
        var x = t/dt * 400;
        if(x == lx) return;
        lx = x;

        var y = 400 - (v-v0)/dv * 400;
        $g.append("<div style='position: absolute; top: " + y + "px; left: " + x + "px; width: 1px; height: 1px; background: red'/>");
        $("#debug").text("t:"+t + ", v:" +v+", x:"+x+", y: "+y);
      };

      window.ani = function (delayMs){
        var start = Date.now();
        var dgt = window.cntr._digits[0];
        var v = dgt.$card0.text() % 10;
        var interv = setInterval(function(){
          var elapsed = Date.now() - start;
          if(elapsed > delayMs){
            dgt.setValue(v + 1);
            clearInterval(interv);
            return;
          }
          var part = elapsed / delayMs;
          dgt.setValue(v+part);
        }, 5);
      }

      var cntr = window.cntr = new MechanicalCounter($("#someValue"), {
        mask: "`7,2",
        value: 345.89
      });

      $("#btn_").click(function(){
        console.log("sp, val: ", cntr._speed, cntr._value);
      });

      $("#btn0").click(function(){
        cntr.setValue(152.999, 20000);
      });

      $("#btnM").click(function(){
        cntr.setValue(132.999, 4000);
      });

      $("#btn1").click(function(){
        cntr.setValue(152.999, 2000);
      });

      $("#btn2").click(function(){
        cntr.setValue(1500022.999, 20000);
      });

      $("#btn3").click(function(){
        cntr.setValue(1500022.999, 2000);
      });

      $("#btn4").click(function(){
        cntr.setValue(1503089.555, 5000);
      });

      $("#btn5").click(function(){
        cntr.setValue(1506067.777, 5000);
      });

      $("#btnGo").click(function(){
        var dif = +$("#difVal").val();
        var time = +$("#time").val();
        function run(){
          cntr.setValue(dif, time);
        };

        $("<div>").text("Знач: "+dif+", время(мс): "+time).appendTo("#list").click(run);
        run();
      });

      function deltaByKeyCode(code){
        switch(code) {
          case 37: return -0.01;
          case 38: return -0.10;
          case 39: return +0.01;
          case 40: return +0.10;
        }
        return 0;
      }

      $("#btnS").keydown(function(e){
        cntr.spinValue(cntr._value + deltaByKeyCode(e.keyCode));
      });

      $("#btnF").keydown(function(e){
        cntr.fillValue(cntr._value + deltaByKeyCode(e.keyCode));
      });

    });
  </script>
  <div id='graph' style='position:absolute; width: 400px; height: 400px; background: #fde; top: 0; left: 200px; z-index: -1'></div>
  <div id='list'></div>
  </body>
</html>
