!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):"object"==typeof exports?t(require("jquery"),require("./vendor/jquery.ui.widget")):t(window.jQuery)}(function(t){function r(t,e){return e=e||1,Math.pow(10,e*t-2)}function a(t,e){return e=e||1,i*r(t,e)/e}function n(t,e){return e=e||1,i*t/e}function o(t,e){return e=e||1,h(t*e*s,e)}function h(t,e){return e=e||1,(i*Math.log(t)+2)/e}function l(t,e){for(var i=e;--t;)i+=e;return i}function u(e,i){var s=this;return this._opts=i=t.extend(u.defaultOptions,i),i.mask&&this._parseMask(i.mask,this._opts),this._validateOpts(),this.$el=t(e).addClass(this._opts.baseClass),Object.defineProperty(this,"_height",{enumerable:!0,configurable:!0,get:function(){var t=s.$el.height();return 0>=t?-1e4:(Object.defineProperty(s,"_height",{value:t,writable:!0,enumerable:!0}),t)}}),this._digits=[],this._initDom(),{execute:function(t,e,i){return s.execute(t,e,i)},spinTo:function(t,e){return s.spinTo(t,e)},resetTo:function(t){return s.resetTo(t)},setImmediate:function(t){return s.resetTo(t)},getValue:function(){return s.getValue()},destroy:function(){return s.destroy()}}}function _(e,i){this.owner=e;var s=this.owner._opts;i&&(this.$sep=t(e._thousandSepStr).prependTo(e.$el)),this.$el=t(e._digitStr).prependTo(e.$el),this.$el.html(e._makeSpan("rect","0")+l(2,e._makeSpan("card",""))),this.$all=this.$el.add(this.$sep),this._showMs=s.showDigitMs,this._num=e._digits.length,this.$all.animate({width:"toggle",opacity:.01},0);var r=this.$el.find("."+s.baseClass+"-card");this.$card0=r.eq(0),this.$card1=r.eq(1),this.empty=!0,this.wasted=!1}var e="mechounter";t.fn[e]=function(i,s,r){var a=s;return(null==i||"object"==typeof i)&&(a=i||{},i="create"),"number"==typeof i&&(s=i,i="spinCloserOrResetTo"),"get"===i?this.eq(0).data(e):"getValue"===i?this.eq(0).data(e).getValue():"create"===i?this.each(function(){var i=t(this);i.data(e)||i.data(e,new u(i,a))}):"getDefaults"===i?u.defaultOptions:this.each(function(){var a=t(this).data(e);a&&a.execute(i,s,r)})};var i=.4342944819032518,s=2.302585092994046;u.defaultOptions={mask:"1.0",decimalSep:".",thousandSep:"",value:0,baseClass:e,showDigitMs:300,refreshDelayMs:30,resetDelayMs:2500,spinCloserSmoothDelayMs:1e3,perceptibleShift:.2,onBeforeSpin:function(){},onSpinStep:function(){}},u.pluginName=e;var p="spinTo,resetTo,setImmediate,spinCloserOrResetTo,destroy".split(",");u.prototype.execute=function(t,e,i){~p.indexOf(t)&&this[t](e,i)},u.prototype._parseMask=function(t,e){t=/(\D?)(\d+)((\D)(\d+))?/.exec(t),t&&(e=e||{},e.thousandSep=t[1],e.digits=t[2],e.decimalSep=t[4]||".",e.decimals=t[5])},u.prototype._validateOpts=function(){var t=this._opts;t.digits=Math.min(15,Math.max(1,Math.floor(+t.digits)||1)),t.decimals=Math.min(t.digits-1,Math.max(0,Math.floor(+t.decimals)||0)),t.intDigits=t.digits-t.decimals,t.multiplier=Math.pow(10,t.decimals)},u.prototype._makeSpan=function(t,e){return"<span class='"+this._opts.baseClass+"-"+t+"'>"+e+"</span>"},u.prototype._addSpan=function(e,i){return t(this._makeSpan(e,i)).prependTo(this.$el)},u.prototype._initDom=function(){var e=this,i=this._opts,s=i.decimals,r=i.intDigits;if(this._oldHtml=this.$el.html(),this.$el.html(""),this._digitStr=this._makeSpan("digit",""),this._thousandSepStr=this._makeSpan("thousandSep",i.thousandSep),s){for(;s--;)this._addDecimalDigit();t(this._makeSpan("decimalSep",i.decimalSep)).prependTo(e.$el)}for(this._addDigit=i.thousandSep?this._addIntDigitWithSep:this._addIntDigit,this._intDigits=0,this._addIntDigit();--r;)this._addDigit();this.setImmediate(i.value)},u.prototype.setImmediate=function(t){this._setImmediate(t*this._opts.multiplier)},u.prototype._setImmediate=function(t){clearInterval(this._interval);var s,a,n,e=this._opts,i=this._digits.length,r=1;for(this._value=t,a=this._digits[0].setVisValue(t),t=Math.floor(.1*t);t>0||r<e.digits||i>r;)n=1>t&&r>=e.digits,s=this._digits[r++]||this._addDigit(),a=s.setVisValue(t+a,n),t=Math.floor(.1*t);this._dropEmptyDigits()},u.prototype._addDecimalDigit=function(t){var e=new _(this,t);return this._digits.push(e),e},u.prototype._addIntDigit=function(t){return this._intDigits++,this._addDecimalDigit(t)},u.prototype._addIntDigitWithSep=function(){return this._addIntDigit(this._intDigits%3===0)},u.prototype._calcSlowdownParams=function(t,e,i){var a,s=o(t),h=0,l=1,u=l,p=1,_=0,d=1,f=s;if(s>e){do a=s,l*=1+p,s=o(t,l),e>s?(p*=.5,l=u):u=l;while(a!==s)}else do a=s,f*=.5,s+=_>d?f:-f,h=e-s,d=r(s),_=(t-n(d))/h;while(a!==s);i(h,s,l,r(s,l))},u.prototype._setSpeed=function(t){var e=this._opts;this._speed=.001*t,this._perceptibleDgt=i*Math.log(this._speed*e.multiplier)-e.perceptibleShift},u.prototype.getValue=function(){return this._value/this._opts.multiplier},u.prototype.spinCloserOrResetTo=function(t){var e=this.getValue(),i=Date.now(),s=this._lastCallMs||i,r=i-s;this._lastCallMs=i,t>e?this.spinTo(t,r+this._opts.spinCloserSmoothDelayMs):this.resetTo(t)},u.prototype.spinTo=function(t,e){this._spinTo(t*this._opts.multiplier,e)},u.prototype._spinTo=function(t,e){if(this._isResetInProgress)return void(this._onResetDone=function(){this._spinTo(t,e)});if(!e||this._value===t)return clearInterval(this._interval),void this._setImmediate(t);var c,i=this,s=this._opts,a=this._value,o=.001*e,h=t-a,l=h>0,u=l?1:-1,p=Math.abs(h),_=1,d=0,f=0;clearInterval(i._interval),this._setImmediate(a),this._calcSlowdownParams(p,o,function(t,e,i,s){f=t,c=e,_=i,d=s}),this._startTime=Date.now(),this._setSpeed(d),this._maxPerceptibleDgt=this._perceptibleDgt,this._currentValues=function(e){var s=.001*e;return f>=s?void(i._value=a+u*d*s):(s-=f,d=r(c-s,_),i._setSpeed(d),i._value=t-u*n(d,_),void(u*i._value<u*a&&(i._value=a)))},function(){for(var r,e=0,s=i._digits.length,n=a,o=t,h=Math.floor(n),u=Math.floor(o),p=n-h,_=o-u;o>=.1||s>e;)r=i._digits[e++]||i._addDigit(),r.createValueUpdaterForSet(n,o,l),p=h%10===9?p:0,h=Math.floor(.1*h),n=h+p,_=u%10===9?_:0,u=Math.floor(.1*u),o=u+_}(),s.onBeforeSpin(e,h,a),i._interval=setInterval(function(){var r=i._elapsed();if(r>=e)return clearInterval(i._interval),void i._setImmediate(t);i._currentValues(r),s.onSpinStep(r,i._value);for(var u,a=i._value+l,n=i._digits.length,o=0,h=0;n>o;)u=1>a&&o>=s.digits,h=i._digits[o++]._updateValue(a,h,u),a=.1*a;i._dropEmptyDigits()},s.refreshDelayMs)},u.prototype.resetTo=function(t){this._resetTo(t*this._opts.multiplier)},u.prototype._resetTo=function(t){var e=this._opts;if(this._value===t)return void this._finalizeValueReset(t);this._isResetInProgress=!0;var l,u,p,_,i=this,r=(this._value,e.resetDelayMs),a=.001*r,o=i._digits.length,h=0;!function(t){for(var e,s=0;o>s;)e=i._digits[s++].prepareValueIntervalForReset(t),e>h&&(h=e),t=Math.floor(.1*t);for(a=.1*a*h,r=.1*r*h;t>0;)i._addDigit().setVisValue(t),t=Math.floor(.1*t)}(t),this._calcSlowdownParams(h,a,function(t,e,i,s){l=t,u=e,p=i,_=s}),function(){for(var t=0,e=n(_,p);o>t;)i._digits[t++].createValueUpdaterForReset(p,u,_,e)}(),this._startTime=Date.now(),clearInterval(i._interval),i._interval=setInterval(function(){var e=0,s=i._elapsed();if(s>=r)return void i._finalizeValueReset(t);for(s*=.001;o>e;)i._digits[e++]._updateValue(s)},e.refreshDelayMs)},u.prototype._finalizeValueReset=function(t){clearInterval(this._interval),this._isResetInProgress=null,this._setImmediate(t),this._onResetDone&&(this._onResetDone(),this._onResetDone=null)},u.prototype._dropEmptyDigits=function(){var t=this._digits.length,e=this._digits[--t];if(e.wasted){do e.remove(),this._intDigits--,e=this._digits[--t];while(e.wasted);this._digits.length=++t}},u.prototype._elapsed=function(){return Date.now()-this._startTime},u.prototype.destroy=function(){clearInterval(this._interval),this.$el.removeClass(this._opts.baseClass).html(this._oldHtml),delete this.$el.data()[e]},_.prototype.reveal=function(){this.$all.animate({width:"toggle"},this._showMs).animate({opacity:1},this._showMs)},_.prototype.remove=function(t){if(t)return this.$all.remove();var e=this;e.$all.stop(!0).animate({opacity:.01},this._showMs).hide(this._showMs,function(){e.$all.remove()})},_.prototype.prepareValueIntervalForReset=function(t){return this._srcVal=this._value%10,this._dstVal=t%10,this._dstVal<this._srcVal&&(this._dstVal+=10),this._aDif=this._dstVal-this._srcVal,this._aDif},_.prototype.createValueUpdaterForReset=function(t,e,i,s){var n,l,r=this,h=0;s>this._aDif?n=o(this._aDif,t):(n=e,h=(this._aDif-s)/i),l=h+n,this._updateValue=function(e){return e>l?void r.setVisValue(r._dstVal):h>=e?void r.setVisValue(r._srcVal+i*e):(e-=h,void r.setVisValue(r._dstVal-a(n-e,t)))}},_.prototype.createValueUpdaterForSet=function(t,e,i){if(i=+i,t===e)return void(this._updateValue=function(){return 0});if(this._setVisValue=i?this.setVis2Value:this.setVisValue,0===this._num)return void(this._updateValue=function(t){return this._setVisValue(t-i)});var s;s=i?function(i){return t>i?t:i>e?e:i}:function(i){return e>i?e:i>t?t:i};var r=this._num-this.owner._maxPerceptibleDgt;return r>=1?void(this._updateValue=function(t,e,i){var r=Math.floor(t);return this._setVisValue(s(r+e),i)}):void(this._updateValue=function(t,e,r){var a=this._num-this.owner._perceptibleDgt;if(1>a)return this._setVisValue(s(t-i),r);var n=Math.floor(t);if(2>a){a--;var o=t-n;return o=a*e+(1-a)*(o-i),this._setVisValue(s(n+o),r)}return this._setVisValue(s(n+e),r)})},_.prototype.setVisValue=function(t,e){this._value=t;var i=Math.floor(t),s=i%10,r=t-i,a=r*this.owner._height,n=a-this.owner._height;this.$card0.css("top",a+"px"),this.$card1.css("top",n+"px");var o=e?"":"0",h=o+s;return this._zRnDgt!==h&&(this._zRnDgt=h,this.$card0.text(0===s?o:s),this.$card1.text(9===s?o:s+1)),e=0===s&&.3>r&&e,!this.empty&&e&&(this.wasted=!0),this.empty&&!e&&this.reveal(),this.empty=e,9!==s?0:r},_.prototype.setVis2Value=function(t,e){var i=this.setVisValue(t,e);return i?i-1:0}});
